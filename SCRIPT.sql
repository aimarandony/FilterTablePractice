CREATE DATABASE BDASPNET;
USE BDASPNET;

CREATE TABLE DISTRITOS(
	iddist INT PRIMARY KEY,
	nomdist VARCHAR(50),
	estado INT
);

CREATE TABLE CLIENTES(
	idcli INT PRIMARY KEY,
	nomcli VARCHAR(50),
	apecli VARCHAR(50),
	iddist INT NOT NULL,
	fecha_reg DATE,
	estado INT,

	CONSTRAINT FK_CLIENTES_IDDIST FOREIGN KEY (iddist) REFERENCES DISTRITOS (iddist)
);

INSERT INTO DISTRITOS VALUES
(1, 'DISTRITO01', 0),(2, 'DISTRITO02', 0),(3, 'DISTRITO03', 0),(4, 'DISTRITO04', 0),(5, 'DISTRITO05', 0);

SELECT * FROM DISTRITOS;

INSERT INTO CLIENTES VALUES
(1,'ANOMBRE01','APELLIDO01','3','2000-12-25',0),(2,'DNOMBRE02','APELLIDO02','3','2002-12-30',0),
(3,'DNOMBRE03','APELLIDO03','1','2002-10-10',0),(4,'BNOMBRE04','APELLIDO04','2','2010-05-23',0),
(5,'ANOMBRE05','APELLIDO05','3','2002-10-24',0),(6,'CNOMBRE06','APELLIDO06','5','2015-07-15',0),
(7,'ANOMBRE07','APELLIDO07','3','2009-01-19',0),(8,'BNOMBRE08','APELLIDO08','4','2019-11-20',0);

SELECT * FROM CLIENTES;

SELECT c.idcli, c.nomcli, c.apecli, d.nomdist, c.fecha_reg, c.estado FROM CLIENTES c 
INNER JOIN DISTRITOS d ON c.iddist = d.iddist;
GO

CREATE PROC USP_CLIENTES_NOMBRE
@nombre VARCHAR(50)
AS
SELECT * FROM CLIENTES WHERE nomcli LIKE @nombre + '%'
GO

USP_CLIENTES_NOMBRE 'A';

CREATE PROC USP_CLIENTES_FECHA
@fecha int
AS
SELECT c.idcli, c.nomcli, c.apecli, d.nomdist, c.fecha_reg, c.estado FROM CLIENTES c 
INNER JOIN DISTRITOS d ON c.iddist = d.iddist WHERE YEAR(c.fecha_reg) = @fecha;
GO

USP_CLIENTES_FECHA 2002;